## Goal

The primary goal of this ADS is to establish a comprehensive framework for detecting and alerting on threat generated by firewall security profiles such as as vulnerabilities, spyware, viruses, and wildfire incidents from Palo Alto Networks next-generation firewalls THREAT log events. This will ensure timely identification and response to security threats, minimizing potential impacts on organizational assets.

## Categorization

These attempts are categorized as:
- [Initial Access / Exploit Public-Facing Application](https://attack.mitre.org/techniques/T1190/)
- [Lateral Movement / Exploitation of Remote Services](https://attack.mitre.org/techniques/T1428/)

## Strategy Abstract

The stragey will function as follows:
- Monitor all THREAT type signatures generated by Palo Alto Networks security profiles.
- Alert on any signature coming from the internal network.
- Alert on any signatures coming from the public network that was alerted (allowed).
- Identify and filter out any known vulnerability scanners or security testing software. 

## Technical Context

This ADS focuses on utilizing the Palo Alto Networks NGFW's comprehensive threat prevention capabilities, particularly from the THREAT log. Key threat types include:

- Antivirus: Detection of viruses and malware payloads.
- Anti-spyware: Identification of spyware communications or attempts.
- Vulnerability Protection: Blocking of vulnerability exploit attempts, especially those targeting public-facing - systems.
- WildFire: Detection of zero-day malware and file-based threats.

The SIEM will process logs in near real-time, identifying critical patterns, such as:

- Multiple threat signatures from either public-facing or internal networks.
- Allowed connections that should trigger alerts if matched against known malicious signatures.

Key log fields include:

- Source IP, Destination IP, Application, Signature ID, and Action (allowed or blocked).

## Blind Spots and Assumptions

This strategy relies on the following assumptions:

- Security profiles are configured according to best practicesn by the vendor.
- SSL inspection is enabled on IPv4 policies to inspect traffic.
- SIEM is successfully indexing network IPS logs.

A blind spot will occur if any of the assumptions are violated. For instance, the following would trip the alert:

- Security profiles are not adequately configured
- SSL inspection is not enabled on IPv4 policies.
- Threat signatures are whitelisted in error (added as an exception in the firewall policy).
- SIEM is failing to index Palo Alto Networks threat logs, leading to missed detections.

## False Positives
There are several instances where false positives will occur:
- Vulnerability scanners: Legitimate scans conducted by IT security teams.
- Misconfigured systems: Erroneous configurations that trigger alerts.
- Legacy applications: Applications that exhibit behavior flagged by NGFW's signatures but are not malicious.

## Validation

Validation can occur for this ADS by performing the following execution on any Windows host:

<code>curl -o eicar.com.txt https://www.eicar.org/download/eicar.com.txt </code>

This test should generate an "EICAR" signature alert from the NGFW antivirus profile, which can be verified in the SIEM for correct log parsing and alerting.

## Priority

The priority is set to medium under all conditions. However, priority can be escalated in case of:

- High volume of threat signatures within a short time frame.
- WildFire detections indicating possible zero-day malware.

## Detection Rules

The following detection rules are in scope for this alerting and detection strategy:
- Palo Alto Networks Multiple Threat Signatures from Public Network
- Palo Alto Networks Multiple Threat Signatures from Private Network
- Palo Alto Networks Vulnerability Signature from Private Network
- Palo Alto Networks Vulnerability Signature Allowed from Public
- Palo Alto Networks Antivirus Signature
- Palo Alto Networks Antispyware Signature
- Palo Alto Networks WildFire Signature
- Palo Alto Networks Zone Protection Signature

If the detection platform can support it, the following rules are additionally recommended:
- First Time Observed Palo Alto Networks Threat Signature
- Highly Relevant Signatures

## Response

In the event that this alert fires, the following response procedures are recommended:

1. Initial Triage:

- Investigate the source and destination IPs to determine whether the event originated from a known entity (e.g., vulnerability scanner, security test) or is suspicious.
- Review the action taken by the firewall (allowed or blocked) and assess the risk based on the severity of the signature.

2. Containment:

- If malicious activity is confirmed, block the source IP at the firewall and isolate affected systems.
- For internal systems triggering alerts, initiate endpoint isolation through your EDR tool to prevent lateral movement.

3. Analysis:

- Conduct a deeper investigation of the associated traffic patterns using network packet captures (PCAPs), reviewing the related URL filtering or application identification logs.
- Correlate this detection with other logs in the SIEM, such as DNS queries, proxy logs, or endpoint logs, to identify additional indicators of compromise (IOCs).

4. Remediation:

- Patch any systems vulnerable to the identified signature (for vulnerability alerts).
- Clean up any infected systems identified through antivirus or WildFire detections.
- Conduct a post-incident review to identify any gaps in detection or response.

5. Reporting:

- Generate an incident report documenting the alert, investigation, containment, and remediation efforts. Provide - feedback to the firewall policy team if any rule adjustments are required.